{"version":3,"file":"errors.js","sourceRoot":"","sources":["../../src/errors.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * ```ts\n * import type { ArangoError, HttpError } from \"arangojs/errors\";\n * ```\n *\n * The \"errors\" module provides types and interfaces for TypeScript related\n * to arangojs error handling.\n *\n * @packageDocumentation\n */\n\nimport * as connection from \"./connection.js\";\nimport { ERROR_ARANGO_MAINTENANCE_MODE } from \"./lib/codes.js\";\n\n/**\n * Indicates whether the given value represents an {@link ArangoError}.\n *\n * @param error - A value that might be an `ArangoError`.\n */\nexport function isArangoError(error: any): error is ArangoError {\n  return Boolean(error && error.isArangoError);\n}\n\n/**\n * Indicates whether the given value represents a {@link NetworkError}.\n *\n * @param error - A value that might be a `NetworkError`.\n */\nexport function isNetworkError(error: any): error is NetworkError {\n  return error instanceof NetworkError;\n}\n\n/**\n * @internal\n *\n * Indicates whether the given value represents a Node.js `SystemError`.\n */\nexport function isSystemError(err: any): err is SystemError {\n  if (!err || !(err instanceof Error)) return false;\n  if (Object.getPrototypeOf(err) !== Error.prototype) return false;\n  const error = err as SystemError;\n  if (typeof error.code !== \"string\") return false;\n  if (typeof error.syscall !== \"string\") return false;\n  return typeof error.errno === \"number\" || typeof error.errno === \"string\";\n}\n\n/**\n * @internal\n *\n * Indicates whether the given value represents a Node.js `UndiciError`.\n */\nexport function isUndiciError(err: any): err is UndiciError {\n  if (!err || !(err instanceof Error)) return false;\n  const error = err as UndiciError;\n  if (typeof error.code !== \"string\") return false;\n  return error.code.startsWith(\"UND_\");\n}\n\n/**\n * @internal\n *\n * Determines whether the given failed fetch error cause is safe to retry.\n */\nfunction isSafeToRetryFailedFetch(error?: Error): boolean | null {\n  if (!error || !error.cause) return null;\n  let cause = error.cause as Error;\n  if (isArangoError(cause) || isNetworkError(cause)) {\n    return cause.isSafeToRetry;\n  }\n  if (\n    isSystemError(cause) &&\n    cause.syscall === \"connect\" &&\n    cause.code === \"ECONNREFUSED\"\n  ) {\n    return true;\n  }\n  if (isUndiciError(cause) && cause.code === \"UND_ERR_CONNECT_TIMEOUT\") {\n    return true;\n  }\n  return isSafeToRetryFailedFetch(cause);\n}\n\n/**\n * Interface representing a Node.js `UndiciError`.\n *\n * @internal\n */\nexport interface UndiciError extends Error {\n  code: `UND_${string}`;\n}\n\n/**\n * Interface representing a Node.js `SystemError`.\n *\n * @internal\n */\nexport interface SystemError extends Error {\n  code: string;\n  errno: number | string;\n  syscall: string;\n}\n\n/**\n * Represents an error from a deliberate timeout encountered while waiting\n * for propagation.\n */\nexport class PropagationTimeoutError extends Error {\n  name = \"PropagationTimeoutError\";\n\n  constructor(message?: string, options: { cause?: Error } = {}) {\n    super(message ?? \"Timed out while waiting for propagation\", options);\n  }\n}\n\n/**\n * Represents a network error or an error encountered while performing a network request.\n */\nexport class NetworkError extends Error {\n  name = \"NetworkError\";\n\n  /**\n   * Indicates whether the request that caused this error can be safely retried.\n   */\n  isSafeToRetry: boolean | null;\n\n  /**\n   * Fetch request object.\n   */\n  request: globalThis.Request;\n\n  constructor(\n    message: string,\n    request: globalThis.Request,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    const { isSafeToRetry = null, ...opts } = options;\n    super(message, opts);\n    this.request = request;\n    this.isSafeToRetry = isSafeToRetry;\n  }\n\n  toJSON() {\n    return {\n      error: true,\n      errorMessage: this.message,\n      code: 0,\n    };\n  }\n}\n\n/**\n * Represents an error from a deliberate timeout encountered while waiting\n * for a server response.\n */\nexport class ResponseTimeoutError extends NetworkError {\n  name = \"ResponseTimeoutError\";\n\n  constructor(\n    message: string | undefined,\n    request: globalThis.Request,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    super(\n      message ?? \"Timed out while waiting for server response\",\n      request,\n      options,\n    );\n  }\n}\n\n/**\n * Represents an error from a request that was aborted.\n */\nexport class RequestAbortedError extends NetworkError {\n  name = \"RequestAbortedError\";\n\n  constructor(\n    message: string | undefined,\n    request: globalThis.Request,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    super(message ?? \"Request aborted\", request, options);\n  }\n}\n\n/**\n * Represents an error from a failed fetch request.\n *\n * The root cause is often extremely difficult to determine.\n */\nexport class FetchFailedError extends NetworkError {\n  name = \"FetchFailedError\";\n\n  constructor(\n    message: string | undefined,\n    request: globalThis.Request,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    let isSafeToRetry =\n      options.isSafeToRetry ?? isSafeToRetryFailedFetch(options.cause);\n    if (options.cause?.cause instanceof Error && options.cause.cause.message) {\n      message = `Fetch failed: ${options.cause.cause.message}`;\n    }\n    super(message ?? \"Fetch failed\", request, { ...options, isSafeToRetry });\n  }\n}\n\n/**\n * Represents a plain HTTP error response.\n */\nexport class HttpError extends NetworkError {\n  name = \"HttpError\";\n\n  /**\n   * HTTP status code of the server response.\n   */\n  code: number;\n\n  /**\n   * Server response object.\n   */\n  response: connection.ProcessedResponse;\n\n  /**\n   * @internal\n   */\n  constructor(\n    response: connection.ProcessedResponse,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    super(connection.getStatusMessage(response), response.request, options);\n    this.response = response;\n    this.code = response.status;\n  }\n\n  toJSON() {\n    return {\n      error: true,\n      errorMessage: this.message,\n      code: this.code,\n    };\n  }\n\n  toString() {\n    return `${this.name} ${this.code}: ${this.message}`;\n  }\n}\n\n/**\n * Represents an error returned by ArangoDB.\n */\nexport class ArangoError extends Error {\n  name = \"ArangoError\";\n\n  /**\n   * Indicates whether the request that caused this error can be safely retried.\n   *\n   * @internal\n   */\n  isSafeToRetry: boolean | null = null;\n\n  /**\n   * @internal\n   */\n  get error(): true {\n    return true;\n  }\n\n  /**\n   * ArangoDB error code.\n   *\n   * See [ArangoDB error documentation](https://www.arangodb.com/docs/stable/appendix-error-codes.html).\n   */\n  errorNum: number;\n\n  /**\n   * Error message accompanying the error code.\n   */\n  get errorMessage(): string {\n    return this.message;\n  }\n\n  /**\n   * HTTP status code included in the server error response object.\n   */\n  code?: number;\n\n  /**\n   * @internal\n   *\n   * Creates a new `ArangoError` from a response object.\n   */\n  static from(\n    response: connection.ProcessedResponse<connection.ArangoErrorResponse>,\n  ): ArangoError {\n    return new ArangoError(response.parsedBody!, {\n      cause: new HttpError(response),\n    });\n  }\n\n  /**\n   * Creates a new `ArangoError` from an ArangoDB error response.\n   */\n  constructor(\n    data: Omit<connection.ArangoErrorResponse, \"error\">,\n    options: { cause?: Error; isSafeToRetry?: boolean | null } = {},\n  ) {\n    const { isSafeToRetry, ...opts } = options;\n    super(data.errorMessage, opts);\n    this.errorNum = data.errorNum;\n    this.code = data.code;\n    if (isSafeToRetry !== undefined) {\n      this.isSafeToRetry = isSafeToRetry;\n    } else if (this.errorNum === ERROR_ARANGO_MAINTENANCE_MODE) {\n      this.isSafeToRetry = true;\n    } else if (this.cause instanceof NetworkError) {\n      this.isSafeToRetry = this.cause.isSafeToRetry;\n    }\n  }\n\n  /**\n   * Server response object.\n   */\n  get response():\n    | connection.ProcessedResponse<connection.ArangoErrorResponse>\n    | undefined {\n    const cause = this.cause;\n    if (cause instanceof HttpError) {\n      return cause.response;\n    }\n    return undefined;\n  }\n\n  /**\n   * Fetch request object.\n   */\n  get request(): globalThis.Request | undefined {\n    const cause = this.cause;\n    if (cause instanceof NetworkError) {\n      return cause.request;\n    }\n    return undefined;\n  }\n\n  /**\n   * @internal\n   *\n   * Indicates that this object represents an ArangoDB error.\n   */\n  get isArangoError(): true {\n    return true;\n  }\n\n  toJSON(): connection.ArangoErrorResponse {\n    return {\n      error: true,\n      errorMessage: this.errorMessage,\n      errorNum: this.errorNum,\n      code: this.code,\n    };\n  }\n\n  toString() {\n    return `${this.name} ${this.errorNum}: ${this.message}`;\n  }\n}\n"]}